---
title: HTTPS连接过程
comments: true
categories: 
- 前端
tags: 
- 面经
- HTTP
---

### HTTPS连接过程

HTTPS是在HTTP的基础上和ssl/tls证书结合起来的一种协议, 保证了传输过程中的安全性, 减少了被恶意劫持的可能. 很好的解决了解决了http的三个缺点（被监听、被篡改、被伪装）

<!-- more -->

#### http通信存在的问题

1. 容易被监听 
http通信都是明文，数据在客户端与服务器通信过程中，任何一点都可能被劫持。比如，发送了银行卡号和密码，hacker劫取到数据，就能看到卡号和密码，这是很危险的
2. 被伪装 
http通信时，无法保证通行双方是合法的，通信方可能是伪装的。比如你请求www.taobao.com, 你怎么知道返回的数据就是来自淘宝，中间人可能返回数据伪装成淘宝。
3. 被篡改 
hacker中间篡改数据后，接收方并不知道数据已经被更改

#### 共享密钥加密和公开密钥加密

1. 共享密钥加密
共享密钥的加密密钥和解密密钥是相同的，所以又称为对称密钥
2. 公开密钥加密
加密算法是公开的，密钥是保密的。公开密钥分为私有密钥和公有密钥，公有密钥是公开的，任何人(客户端)都可以获取，客户端使用公有密钥加密数据，服务端用私有密钥解密数据。
3. 异同
共享密钥加密与公开密钥加密相比，加解密处理速度快，但公开密钥更适应互联网下使用

#### https解决的问题

https很好的解决了http的三个缺点（被监听、被篡改、被伪装），https不是一种新的协议，它是http+SSL(TLS)的结合体，SSL是一种独立协议，所以其它协议比如smtp等也可以跟ssl结合。https改变了通信方式，它由以前的http----->tcp，改为http------>SSL----->tcp；https采用了共享密钥加密+公开密钥加密的方式

1. 防监听
数据是加密的，所以监听得到的数据是密文，hacker看不懂。
2. 防伪装
伪装分为客户端伪装和服务器伪装，通信双方携带证书，证书相当于身份证，有证书就认为合法，没有证书就认为非法，证书由第三方颁布，很难伪造
3. 防篡改
https对数据做了摘要，篡改数据会被感知到。hacker即使从中改了数据也白搭。

#### https连接过程

服务器端需要认证的通信过程

```sequence
client->server: 发送客户端支持的加密协议及版本(SSL\TLS)
server-->client: 服务器端从中选择合适的加密协议
server-->client: 服务器端返回证书，证书中有公钥
client->server: 客户端使用根证书验证证书合法性
client->server: 客户端生成对称密钥，通过证书中的公钥加密，发送到服务器端
server-->client:服务器端使用私钥解密，获取对称密钥，使用对称密钥加密数据
client->server: 客户端解密数据，SSL开始通信
```

1. 客户端发送请求到服务器端
2. 服务器端返回证书和公开密钥，公开密钥作为证书的一部分而存在
3. 客户端验证证书和公开密钥的有效性，如果有效，则生成共享密钥并使用公开密钥加密发送到服务器端
4. 服务器端使用私有密钥解密数据，并使用收到的共享密钥加密数据，发送到客户端
5. 客户端使用共享密钥解密数据
6. SSL加密建立

#### 客户端认证的通信的过程

客户端需要认证的过程跟服务器端需要认证的过程基本相同，并且少了最开始的两步。这种情况都是证书存储在客户端，并且应用场景比较少，一般金融才使用，比如支付宝、银行客户端都需要安装证书。

#### 后续的问题

1. 怎样保证公开密钥的有效性
你也许会想到，怎么保证客户端收到的公开密钥是合法的，不是伪造的，证书很好的完成了这个任务。证书由权威的第三方机构颁发，并且对公开密钥做了签名。
2. https的缺点
https保证了通信的安全，但带来了加密解密消耗计算机cpu资源的问题 ，不过，有专门的https加解密硬件服务器
3. 各大互联网公司，百度、淘宝、支付宝、知乎都使用https协议，为什么？
支付宝涉及到金融，所以出于安全考虑采用https这个，可以理解，为什么百度、知乎等也采用这种方式？为了防止运营商劫持！http通信时，运营商在数据中插入各种广告，用户看到后，怒火发到互联网公司，其实这些坏事都是运营商(移动、联通、电信)干的, 用了https，运营商就没法插播广告篡改数据了。

转发：https://blog.csdn.net/wangjun5159/article/details/51510594
